<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Técnico · Historial</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/tecnico.css') }}">
  <style>:root{ --hero-url:url("{{ url_for('static', filename='img/gobierno.jpg') }}"); }</style>

  <script defer src="{{ url_for('static', filename='js/tecnico.js') }}"></script>
</head>
<body data-scope="historial">
  <!-- HERO -->
  <header class="site-header hero">
    <div class="brand-row">
      <div class="hero-title"><h1 class="site-title">TÉCNICO</h1></div>
    </div>
  </header>

  <!-- Menú -->
  <nav class="sol-nav">
    <a class="nav-link" href="{{ url_for('tecnico_disponibles') }}">Disponibles</a>
    <a class="nav-link" href="{{ url_for('tecnico_asignados') }}">Mis asignados</a>
    <a class="nav-link active" href="{{ url_for('tecnico_historial') }}">Historial</a>
    <a class="nav-link nav-link--logout" href="{{ url_for('root_index') }}">Salir</a>
  </nav>

  <!-- Perfil del técnico -->
  <section id="techProfile" class="tech-profile" aria-label="Perfil del técnico"></section>

  <main class="container" style="margin:16px auto 28px">
    <h2 style="margin:8px 0 4px;">Historial</h2>
    <p class="intro">Tickets en los que participaste y están <strong>RESUELTO</strong> o <strong>CANCELADO</strong>.</p>

    <div class="toolbar">
      <button id="btnRefresh" class="btn">Actualizar</button>
      <div class="spacer"></div>
      <input id="q" type="search" placeholder="Buscar por asunto / solicitante" class="btn" />
    </div>

    <div id="grid" class="ticket-grid"></div>
  </main>

  <!-- Diálogo de detalle (solo lectura en historial) -->
  <dialog id="dlg" class="tk-dialog" aria-labelledby="dlgTitle">
    <div id="dlgBody" class="tk-body"></div>
    <div class="tk-actions">
      <button id="dlgClose" class="btn">Cerrar</button>
      <!-- Estos quedan ocultos en historial por el JS -->
      <select id="estadoSel" class="btn" style="min-width:170px; display:none">
        <option value="EN_CURSO">EN_CURSO</option>
        <option value="RESUELTO">RESUELTO</option>
        <option value="CANCELADO">CANCELADO</option>
      </select>
      <button id="btnEstado" class="btn btn-primary" style="display:none">Guardar estado</button>
      <button id="btnTomar" class="btn btn-primary" style="display:none">Asignarme</button>
    </div>
  </dialog>

  <!-- Diálogo de asignación (se mantiene por compatibilidad del JS) -->
  <dialog id="assignDlg" class="tk-dialog" aria-labelledby="assignTitle">
    <div class="tk-body">
      <h3 class="tk-title" id="assignTitle">Asignar ticket</h3>
      <div class="tk-kv" style="align-items:flex-start">
        <span>Modo</span>
        <div>
          <label style="display:inline-flex;align-items:center;gap:8px;margin-right:12px">
            <input type="radio" name="assignMode" id="optSolo" value="solo" checked />
            <strong>Solo yo</strong>
          </label>
          <label style="display:inline-flex;align-items:center;gap:8px">
            <input type="radio" name="assignMode" id="optEquipo" value="equipo" />
            <strong>En equipo</strong>
          </label>
        </div>
      </div>
      <div id="assignEquipoWrap" style="display:none; margin-top:8px">
        <div class="note">Selecciona técnicos adicionales:</div>
        <div id="assignList" style="margin-top:8px; display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:8px"></div>
        <div id="assignNoOthers" class="note" style="display:none;margin-top:6px">No hay otros técnicos activos disponibles.</div>
      </div>
    </div>
    <div class="tk-actions">
      <button id="assignCancel" class="btn">Cancelar</button>
      <button id="assignConfirm" class="btn btn-primary">Confirmar</button>
    </div>
  </dialog>

  <div id="toastWrap" class="toast-wrap" aria-live="polite" aria-atomic="true"></div>
</body>
</html>